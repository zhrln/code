<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no, address=no, email=no, time=no">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0">
    <title>APP 下载</title>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden
        }
    </style>
    <script type="text/javascript" src="//g.alicdn.com/mtb/??lib-flexible/0.3.2/flexible.js,app-jump/0.6.6/combo.js,app-jump/0.6.6/jump_css.js,app-jump/0.6.6/jump.js"></script>
</head>
<body>
<script>
    (function(){
        /* 这里是从淘宝电影弄下来的代码,用于创建Intent */
        var simpleLocation = function (a) {
            var b = {'href': a};
            var c = a.split('://');
            b._protocol = c.shift();
            b.protocol = b._protocol + ':';
            c = c.join('://').split('/');
            b.host = c.shift();
            b.hostname = b.host.split(':')[0];
            b.port = b.host.split(':')[1] || '';
            c = c.join('/').split('?');
            b._pathname = c.shift();
            b.pathname = '/' + b._pathname;
            c = c.join('?').split('#');
            b._search = c.shift().replace(/<|>|%3C|%3E/gi, '');
            b.search = b._search ? ('?' + b._search) : '';
            b._hash = c.join('#');
            b.hash = b._hash ? ('#' + b._hash) : '';
            return b
        };
        var buildIntent = function (a) {
            var b = simpleLocation(a);
            var c = {
                alipays: "com.eg.android.AlipayGphone",
                tbmovie: "com.taobao.movie.android",
                taobaowebview: "com.taobao.taobao",
                taobao: "com.taobao.taobao",
                tmall: "com.tmall.wireless",
                yulebao: "com.taobao.android.taotv.yulebao"
            };
            var d = 'Intent;scheme=' + b._protocol + ';package=' + c[b._protocol] + ';end', intent_Protocol = 'intent', intentUri = intent_Protocol + '://' + b.host + b.pathname + b.search + '#' + d;
            return intentUri
        };
        var openIframeIntent = function (a) {
            var b = document.getElementById('iframeGo');
            if (!b) {
                b = document.createElement('iframe');
                b.id = 'iframeGo';
                b.name = 'iframeGo';
                b.style.display = 'none';
                document.body.appendChild(b)
            }
            b.src = a
        };
        var clickOpenIntent = function (a, b) {
            var c = document.getElementById('openAppLinkWithClick'), evt;
            if (!c) {
                c = document.createElement('a');
                c.id = 'openAppLinkWithClick';
                c.innerHTML = 'clickOpenIntent';
                if (!window.debug) {
                    c.style.display = 'none'
                }
                document.body.appendChild(c)
            }
            if (b) {
                c.target = 'iframeGo'
            } else {
                c.target = '_blank'
            }
            c.href = a;
            if (window.CustomEvent) {
                evt = new window.CustomEvent('click', {canBubble: false, cancelable: false})
            } else {
                evt = document.createEvent('HTMLEvents');
                evt.initEvent('click', false, false)
            }
            c.dispatchEvent(evt)
        };
        //这句是appcall 的代码,用于直接跳转: lib.callapp.gotoPage(getParams('to'));
        function getParams(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = location.search.substr(1).match(reg);
            return r ? decodeURIComponent(r[2]) : '';
        }

        var JUMP_DATA = {
            altText: getParams('tips') || '亲，如果未下载娱乐宝APP，快去下载吧',
            url: getParams('url') || "//yulebao.taobao.com",
            auto: "false",
            downUrl: getParams('dl') || '//www.taobao.com/go/act/video/ylb/app-download.php',
            downText: getParams('btnText') || '下载娱乐宝APP',
            text: "正在打开...",
            goText: "暂不下载",
            schema: getParams('to') || "yulebao://yulebao.taobao.com"
        };

        var localUrl = new lib.httpurl(location.href);

        var useIntent = lib.env.os.isAndroid && lib.env.os.version.gte('4.4');
        var schema = JUMP_DATA.schema;
        var url = JUMP_DATA.url;
        var auto = JUMP_DATA.auto;
        var downUrl = JUMP_DATA.downUrl;
        if (downUrl) {
            downUrl = decodeURIComponent(downUrl)
        }
        var fillSchemaKeys = schema.match(/\\{\\{([^{}]+)\\}\\}/g);
        var fillJumpKeys = url.match(/\\{\\{([^{}]+)\\}\\}/g);
        if (fillSchemaKeys) {
            for (var i = 0; i < fillSchemaKeys.length; i++) {
                schema = schema.replace(new RegExp(fillSchemaKeys[i].replace(/([{}])/g, function (a) {
                    return "\\\\" + a
                }), "gi"), localUrl.params[fillSchemaKeys[i].replace(/([{}])/g, "")] || "")
            }
        }
        if (fillJumpKeys) {
            for (var i = 0; i < fillJumpKeys.length; i++) {
                url = url.replace(new RegExp(fillJumpKeys[i].replace(/([{}])/g, function (a) {
                    return "\\\\" + a;
                }), "gi"), localUrl.params[fillJumpKeys[i].replace(/([{}])/g, "")] || "")
            }
        }
        var schemaUrl = new lib.httpurl(schema);
        var jumpUrl = new lib.httpurl(url);

        for (var key in localUrl.params) {
            schemaUrl.params[key] = localUrl.params[key];
            jumpUrl.params[key] = localUrl.params[key]
        }
        app.jump.tip({
            schema: schemaUrl.toString(),
            goText: JUMP_DATA.goText || "继续访问",
            downText: JUMP_DATA.downText || "下载娱乐宝APP",
            text: JUMP_DATA.text || "正在打开娱乐宝APP...",
            altText: JUMP_DATA.altText || "如果您未安装娱乐宝，还可以：",
            onGo: function () {
                location.href = url.toString()
            },
            downUrl: downUrl
        });
        /* 如果是安卓4.4及以上,就用Intent调用,这里比较坑爹,iframe里打不开,只能新窗口打开了*/
        if(useIntent){
            clickOpenIntent(buildIntent(schemaUrl.toString()));
        }
        if (auto === true || auto === "true" || auto === "1") {
            setTimeout(function () {
                location.href = jumpUrl.toString()
            }, 1500)
        }
    }());

</script>
</body>
</html>